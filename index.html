<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>水位計測試工具</title>
    <script src="./public/vue.js"></script>
    <link href="./public/bootstrap.css" rel="stylesheet">
    <script src="./public/bootstrap.js"></script>
</head>

<body class="container" id="app">

    <h1 class="d-flex justify-content-center mt-4">水位計測試工具</h1>
    
    <div class="row d-flex justify-content-center mt-5">
        <div class="col-10">
            <div class="row g-3">
                <div class="col" v-for="button in buttons" :key="button.name">
                    <button @click="buttonClick(button.name)" :class="['btn', button.class, 'btn-lg', 'w-100']" v-html="button.label">
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="row d-flex justify-content-center mt-4">
        <div class="col-10">
            <div class="bg-light border rounded p-3">
                <h5>Last Button Clicked:</h5>
                <p class="fs-4 text-center" v-if="lastClicked">{{ lastClicked }}</p>
                <p class="text-muted text-center" v-else>No button clicked yet</p>
            </div>
        </div>
    </div>

    <!-- xm125測試結果顯示在首頁 -->
    <div class="row d-flex justify-content-center mt-4" v-if="stats">
        <div class="col-10">
            <div class="bg-light border rounded p-3">
                <h5>測量統計結果：</h5>
                <div class="row">
                    <div class="col">
                        <p><strong>平均值：</strong> {{ stats.mean.toFixed(2) }}</p>
                        <p><strong>標準差：</strong> {{ stats.stdDev.toFixed(2) }}</p>
                    </div>
                    <div class="col">
                        <p><strong>範圍：</strong> {{ stats.range.toFixed(2) }}</p>
                        <p><strong>最大值：</strong> {{ stats.max.toFixed(2) }}</p>
                        <p><strong>最小值：</strong> {{ stats.min.toFixed(2) }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 掃碼輸入 Modal -->
    <div class="modal fade" id="scanModal" tabindex="-1" aria-labelledby="scanModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="scanModalLabel">掃碼輸入 - {{ currentButton }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- xm125結果顯示在modal (只在按鈕A且有統計資料時顯示) -->
                    <div v-if="currentButton === '按鈕 A' && stats" class="mb-4">
                        <h6>本次測量統計結果：</h6>
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <p class="mb-1"><strong>平均值：</strong> {{ stats.mean.toFixed(2) }}</p>
                                        <p class="mb-1"><strong>標準差：</strong> {{ stats.stdDev.toFixed(2) }}</p>
                                    </div>
                                    <div class="col">
                                        <p class="mb-1"><strong>範圍：</strong> {{ stats.range.toFixed(2) }}</p>
                                        <p class="mb-1"><strong>最大值：</strong> {{ stats.max.toFixed(2) }}</p>
                                        <p class="mb-1"><strong>最小值：</strong> {{ stats.min.toFixed(2) }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="scanInput" class="form-label">請輸入掃碼結果：</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="scanInput" 
                            v-model="scanInput"
                            placeholder="請掃描或手動輸入..."
                            @keyup.enter="saveScanData"
                            ref="scanInputRef">
                    </div>
                    <div v-if="savedData.length > 0" class="mt-3">
                        <h6>已儲存的掃碼記錄：</h6>
                        <div class="list-group" style="max-height: 200px; overflow-y: auto;">
                            <div v-for="(data, index) in savedData" :key="index" class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>{{ data.button }}:</strong> {{ data.scanResult }}
                                    <br><small class="text-muted">{{ formatTimestamp(data.timestamp) }}</small>
                                </div>
                                <button @click="deleteScanData(index)" class="btn btn-sm btn-outline-danger">刪除</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" @click="saveScanData">儲存</button>
                    <button type="button" class="btn btn-warning" @click="clearAllData">清除全部</button>
                </div>
            </div>
        </div>
    </div>

    <script src="./src/index.js"></script>
</body>

</html>